<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login Dispatch NFFA</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;font-family:Inter,system-ui;background:linear-gradient(135deg,#fee2e2,#fecaca);}
.card{width:360px;background:white;padding:32px;border-radius:18px;box-shadow:0 20px 40px rgba(0,0,0,.15);}
h2{margin-top:0;color:#991b1b;}
input{width:100%;padding:12px;margin:10px 0;border-radius:10px;border:1px solid #fecaca;font-size:14px;}
input:focus{outline:none;border-color:#e11d48;box-shadow:0 0 0 3px rgba(225,29,72,.15);}
button{width:100%;padding:12px;margin-top:10px;background:#e11d48;color:white;border:0;border-radius:10px;font-weight:600;cursor:pointer;}
button:hover{background:#be123c;}
#error{color:#dc2626;margin-top:10px;font-size:14px;}
</style>
</head>

<body>
<div class="card">
<h2>Connexion Dispatch</h2>
<input id="user" placeholder="Utilisateur">
<input id="password" type="password" placeholder="Mot de passe">
<button onclick="login()">Se connecter</button>
<div id="error"></div>
</div>

<script>
const supabase = supabaseJs.createClient(
  "https://gktawbaposndfxijkxdk.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrdGF3YmFwb3NuZGZ4aWpreGRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNzUyNDUsImV4cCI6MjA3OTY1MTI0NX0.tY-CHuyb2zr9s6hlGkwmrdTvg920VVNghI9S45CjwKk"
)

async function login(){
  error.textContent = ""
  const u = user.value.trim()
  const p = password.value.trim()
  if(!u || !p){error.textContent="Champs requis";return;}

  const { data, error:err } = await supabase
    .from("users-nffa")
    .select("*")
    .eq("user", u)
    .eq("password", p)
    .single()

  if(err || !data){error.textContent="Identifiants incorrects"; return;}

  // Pr√©sence active
  await supabase.from("users-nffa")
    .update({ presence:true, last_seen:new Date() })
    .eq("id", data.id)

  localStorage.setItem("nffa_user", JSON.stringify(data))
  location.href="index.html"
}
</script>
</body>
</html>
